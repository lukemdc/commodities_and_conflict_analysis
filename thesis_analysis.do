/*
ENV lasso and stepwise simulations for UNCOMTRADE data and controls
written in Stata 13.1
*/
capture log using thesis_log, append

clear all
cd "E:\Research Files\Nicholas School Research, 2012-2013\Senior Thesis, ENV\ENV Data\New Commodity data\"
use "maier_thesis_UNCOMTRADE_allzstats.dta", clear
save "maier_thesis_UNCOMTRADE_allzstats_copy.dta", replace
set seed 1234

*for the full zstat set
destring reporteriso reportercode gdp_2005usd prioiso priocode reporter pop lpop incidencev414 newconflictinyearv414 numbrofyearsonsetv414 onset1v414 onset2v414 onset5v414 onset8v414 onset20v414 maxintyearv414 noterrconfv414 nogovconfv414 nototconfv414 govonlyv414 terronlyv414 bothgovterrv414 sumconfv414 elf1 pol1 fh_status pts_amn pts_ussd cyear country flag fragment democ autoc polity polity2 durable terrorbomb_deaths z_index_03_export z_index_05_export z_index_07_export z_index_10_export z_index_03_import z_index_05_import z_index_07_import z_index_10_import polstab ruleoflaw zstat_03_export_01  zstat_03_export_02  zstat_03_export_03  zstat_03_export_04  zstat_03_export_05  zstat_03_export_06  zstat_03_export_07  zstat_03_export_08  zstat_03_export_09  zstat_03_export_10  zstat_03_export_11  zstat_03_export_12  zstat_03_export_13  zstat_03_export_14  zstat_03_export_15  zstat_03_export_16  zstat_03_export_17  zstat_03_export_18  zstat_03_export_19  zstat_03_export_20  zstat_03_export_21  zstat_03_export_22  zstat_03_export_23  zstat_03_export_24  zstat_03_export_25  zstat_03_export_26  zstat_03_export_27  zstat_03_export_2709  zstat_03_export_2710  zstat_03_export_2711  zstat_03_export_28  zstat_03_export_29  zstat_03_export_30  zstat_03_export_31  zstat_03_export_32  zstat_03_export_33  zstat_03_export_34  zstat_03_export_35  zstat_03_export_36  zstat_03_export_37  zstat_03_export_38  zstat_03_export_39  zstat_03_export_40  zstat_03_export_41  zstat_03_export_42  zstat_03_export_43  zstat_03_export_44  zstat_03_export_45  zstat_03_export_46  zstat_03_export_47  zstat_03_export_48  zstat_03_export_49  zstat_03_export_50  zstat_03_export_51  zstat_03_export_52  zstat_03_export_53  zstat_03_export_54  zstat_03_export_55  zstat_03_export_56  zstat_03_export_57  zstat_03_export_58  zstat_03_export_59  zstat_03_export_60  zstat_03_export_61  zstat_03_export_62  zstat_03_export_63  zstat_03_export_64  zstat_03_export_65  zstat_03_export_66  zstat_03_export_67  zstat_03_export_68  zstat_03_export_69  zstat_03_export_70  zstat_03_export_71  zstat_03_export_72  zstat_03_export_73  zstat_03_export_74  zstat_03_export_75  zstat_03_export_76  zstat_03_export_78  zstat_03_export_79  zstat_03_export_80  zstat_03_export_81  zstat_03_export_82  zstat_03_export_83  zstat_03_export_84  zstat_03_export_85  zstat_03_export_86  zstat_03_export_87  zstat_03_export_88  zstat_03_export_89  zstat_03_export_90  zstat_03_export_91  zstat_03_export_92  zstat_03_export_93  zstat_03_export_94  zstat_03_export_95  zstat_03_export_96  zstat_03_export_97  zstat_03_export_99  zstat_03_import_01  zstat_03_import_02  zstat_03_import_03  zstat_03_import_04  zstat_03_import_05  zstat_03_import_06  zstat_03_import_07  zstat_03_import_08  zstat_03_import_09  zstat_03_import_10  zstat_03_import_11  zstat_03_import_12  zstat_03_import_13  zstat_03_import_14  zstat_03_import_15  zstat_03_import_16  zstat_03_import_17  zstat_03_import_18  zstat_03_import_19  zstat_03_import_20  zstat_03_import_21  zstat_03_import_22  zstat_03_import_23  zstat_03_import_24  zstat_03_import_25  zstat_03_import_26  zstat_03_import_27  zstat_03_import_2709  zstat_03_import_2710  zstat_03_import_2711  zstat_03_import_28  zstat_03_import_29  zstat_03_import_30  zstat_03_import_31  zstat_03_import_32  zstat_03_import_33  zstat_03_import_34  zstat_03_import_35  zstat_03_import_36  zstat_03_import_37  zstat_03_import_38  zstat_03_import_39  zstat_03_import_40  zstat_03_import_41  zstat_03_import_42  zstat_03_import_43  zstat_03_import_44  zstat_03_import_45  zstat_03_import_46  zstat_03_import_47  zstat_03_import_48  zstat_03_import_49  zstat_03_import_50  zstat_03_import_51  zstat_03_import_52  zstat_03_import_53  zstat_03_import_54  zstat_03_import_55  zstat_03_import_56  zstat_03_import_57  zstat_03_import_58  zstat_03_import_59  zstat_03_import_60  zstat_03_import_61  zstat_03_import_62  zstat_03_import_63  zstat_03_import_64  zstat_03_import_65  zstat_03_import_66  zstat_03_import_67  zstat_03_import_68  zstat_03_import_69  zstat_03_import_70  zstat_03_import_71  zstat_03_import_72  zstat_03_import_73  zstat_03_import_74  zstat_03_import_75  zstat_03_import_76  zstat_03_import_78  zstat_03_import_79  zstat_03_import_80  zstat_03_import_81  zstat_03_import_82  zstat_03_import_83  zstat_03_import_84  zstat_03_import_85  zstat_03_import_86  zstat_03_import_87  zstat_03_import_88  zstat_03_import_89  zstat_03_import_90  zstat_03_import_91  zstat_03_import_92  zstat_03_import_93  zstat_03_import_94  zstat_03_import_95  zstat_03_import_96  zstat_03_import_97  zstat_03_import_99  zstat_05_export_01  zstat_05_export_02  zstat_05_export_03  zstat_05_export_04  zstat_05_export_05  zstat_05_export_06  zstat_05_export_07  zstat_05_export_08  zstat_05_export_09  zstat_05_export_10  zstat_05_export_11  zstat_05_export_12  zstat_05_export_13  zstat_05_export_14  zstat_05_export_15  zstat_05_export_16  zstat_05_export_17  zstat_05_export_18  zstat_05_export_19  zstat_05_export_20  zstat_05_export_21  zstat_05_export_22  zstat_05_export_23  zstat_05_export_24  zstat_05_export_25  zstat_05_export_26  zstat_05_export_27  zstat_05_export_2709  zstat_05_export_2710  zstat_05_export_2711  zstat_05_export_28  zstat_05_export_29  zstat_05_export_30  zstat_05_export_31  zstat_05_export_32  zstat_05_export_33  zstat_05_export_34  zstat_05_export_35  zstat_05_export_36  zstat_05_export_37  zstat_05_export_38  zstat_05_export_39  zstat_05_export_40  zstat_05_export_41  zstat_05_export_42  zstat_05_export_43  zstat_05_export_44  zstat_05_export_45  zstat_05_export_46  zstat_05_export_47  zstat_05_export_48  zstat_05_export_49  zstat_05_export_50  zstat_05_export_51  zstat_05_export_52  zstat_05_export_53  zstat_05_export_54  zstat_05_export_55  zstat_05_export_56  zstat_05_export_57  zstat_05_export_58  zstat_05_export_59  zstat_05_export_60  zstat_05_export_61  zstat_05_export_62  zstat_05_export_63  zstat_05_export_64  zstat_05_export_65  zstat_05_export_66  zstat_05_export_67  zstat_05_export_68  zstat_05_export_69  zstat_05_export_70  zstat_05_export_71  zstat_05_export_72  zstat_05_export_73  zstat_05_export_74  zstat_05_export_75  zstat_05_export_76  zstat_05_export_78  zstat_05_export_79  zstat_05_export_80  zstat_05_export_81  zstat_05_export_82  zstat_05_export_83  zstat_05_export_84  zstat_05_export_85  zstat_05_export_86  zstat_05_export_87  zstat_05_export_88  zstat_05_export_89  zstat_05_export_90  zstat_05_export_91  zstat_05_export_92  zstat_05_export_93  zstat_05_export_94  zstat_05_export_95  zstat_05_export_96  zstat_05_export_97  zstat_05_export_99  zstat_05_import_01  zstat_05_import_02  zstat_05_import_03  zstat_05_import_04  zstat_05_import_05  zstat_05_import_06  zstat_05_import_07  zstat_05_import_08  zstat_05_import_09  zstat_05_import_10  zstat_05_import_11  zstat_05_import_12  zstat_05_import_13  zstat_05_import_14  zstat_05_import_15  zstat_05_import_16  zstat_05_import_17  zstat_05_import_18  zstat_05_import_19  zstat_05_import_20  zstat_05_import_21  zstat_05_import_22  zstat_05_import_23  zstat_05_import_24  zstat_05_import_25  zstat_05_import_26  zstat_05_import_27  zstat_05_import_2709  zstat_05_import_2710  zstat_05_import_2711  zstat_05_import_28  zstat_05_import_29  zstat_05_import_30  zstat_05_import_31  zstat_05_import_32  zstat_05_import_33  zstat_05_import_34  zstat_05_import_35  zstat_05_import_36  zstat_05_import_37  zstat_05_import_38  zstat_05_import_39  zstat_05_import_40  zstat_05_import_41  zstat_05_import_42  zstat_05_import_43  zstat_05_import_44  zstat_05_import_45  zstat_05_import_46  zstat_05_import_47  zstat_05_import_48  zstat_05_import_49  zstat_05_import_50  zstat_05_import_51  zstat_05_import_52  zstat_05_import_53  zstat_05_import_54  zstat_05_import_55  zstat_05_import_56  zstat_05_import_57  zstat_05_import_58  zstat_05_import_59  zstat_05_import_60  zstat_05_import_61  zstat_05_import_62  zstat_05_import_63  zstat_05_import_64  zstat_05_import_65  zstat_05_import_66  zstat_05_import_67  zstat_05_import_68  zstat_05_import_69  zstat_05_import_70  zstat_05_import_71  zstat_05_import_72  zstat_05_import_73  zstat_05_import_74  zstat_05_import_75  zstat_05_import_76  zstat_05_import_78  zstat_05_import_79  zstat_05_import_80  zstat_05_import_81  zstat_05_import_82  zstat_05_import_83  zstat_05_import_84  zstat_05_import_85  zstat_05_import_86  zstat_05_import_87  zstat_05_import_88  zstat_05_import_89  zstat_05_import_90  zstat_05_import_91  zstat_05_import_92  zstat_05_import_93  zstat_05_import_94  zstat_05_import_95  zstat_05_import_96  zstat_05_import_97  zstat_05_import_99  zstat_07_export_01  zstat_07_export_02  zstat_07_export_03  zstat_07_export_04  zstat_07_export_05  zstat_07_export_06  zstat_07_export_07  zstat_07_export_08  zstat_07_export_09  zstat_07_export_10  zstat_07_export_11  zstat_07_export_12  zstat_07_export_13  zstat_07_export_14  zstat_07_export_15  zstat_07_export_16  zstat_07_export_17  zstat_07_export_18  zstat_07_export_19  zstat_07_export_20  zstat_07_export_21  zstat_07_export_22  zstat_07_export_23  zstat_07_export_24  zstat_07_export_25  zstat_07_export_26  zstat_07_export_27  zstat_07_export_2709  zstat_07_export_2710  zstat_07_export_2711  zstat_07_export_28  zstat_07_export_29  zstat_07_export_30  zstat_07_export_31  zstat_07_export_32  zstat_07_export_33  zstat_07_export_34  zstat_07_export_35  zstat_07_export_36  zstat_07_export_37  zstat_07_export_38  zstat_07_export_39  zstat_07_export_40  zstat_07_export_41  zstat_07_export_42  zstat_07_export_43  zstat_07_export_44  zstat_07_export_45  zstat_07_export_46  zstat_07_export_47  zstat_07_export_48  zstat_07_export_49  zstat_07_export_50  zstat_07_export_51  zstat_07_export_52  zstat_07_export_53  zstat_07_export_54  zstat_07_export_55  zstat_07_export_56  zstat_07_export_57  zstat_07_export_58  zstat_07_export_59  zstat_07_export_60  zstat_07_export_61  zstat_07_export_62  zstat_07_export_63  zstat_07_export_64  zstat_07_export_65  zstat_07_export_66  zstat_07_export_67  zstat_07_export_68  zstat_07_export_69  zstat_07_export_70  zstat_07_export_71  zstat_07_export_72  zstat_07_export_73  zstat_07_export_74  zstat_07_export_75  zstat_07_export_76  zstat_07_export_78  zstat_07_export_79  zstat_07_export_80  zstat_07_export_81  zstat_07_export_82  zstat_07_export_83  zstat_07_export_84  zstat_07_export_85  zstat_07_export_86  zstat_07_export_87  zstat_07_export_88  zstat_07_export_89  zstat_07_export_90  zstat_07_export_91  zstat_07_export_92  zstat_07_export_93  zstat_07_export_94  zstat_07_export_95  zstat_07_export_96  zstat_07_export_97  zstat_07_export_99  zstat_07_import_01  zstat_07_import_02  zstat_07_import_03  zstat_07_import_04  zstat_07_import_05  zstat_07_import_06  zstat_07_import_07  zstat_07_import_08  zstat_07_import_09  zstat_07_import_10  zstat_07_import_11  zstat_07_import_12  zstat_07_import_13  zstat_07_import_14  zstat_07_import_15  zstat_07_import_16  zstat_07_import_17  zstat_07_import_18  zstat_07_import_19  zstat_07_import_20  zstat_07_import_21  zstat_07_import_22  zstat_07_import_23  zstat_07_import_24  zstat_07_import_25  zstat_07_import_26  zstat_07_import_27  zstat_07_import_2709  zstat_07_import_2710  zstat_07_import_2711  zstat_07_import_28  zstat_07_import_29  zstat_07_import_30  zstat_07_import_31  zstat_07_import_32  zstat_07_import_33  zstat_07_import_34  zstat_07_import_35  zstat_07_import_36  zstat_07_import_37  zstat_07_import_38  zstat_07_import_39  zstat_07_import_40  zstat_07_import_41  zstat_07_import_42  zstat_07_import_43  zstat_07_import_44  zstat_07_import_45  zstat_07_import_46  zstat_07_import_47  zstat_07_import_48  zstat_07_import_49  zstat_07_import_50  zstat_07_import_51  zstat_07_import_52  zstat_07_import_53  zstat_07_import_54  zstat_07_import_55  zstat_07_import_56  zstat_07_import_57  zstat_07_import_58  zstat_07_import_59  zstat_07_import_60  zstat_07_import_61  zstat_07_import_62  zstat_07_import_63  zstat_07_import_64  zstat_07_import_65  zstat_07_import_66  zstat_07_import_67  zstat_07_import_68  zstat_07_import_69  zstat_07_import_70  zstat_07_import_71  zstat_07_import_72  zstat_07_import_73  zstat_07_import_74  zstat_07_import_75  zstat_07_import_76  zstat_07_import_78  zstat_07_import_79  zstat_07_import_80  zstat_07_import_81  zstat_07_import_82  zstat_07_import_83  zstat_07_import_84  zstat_07_import_85  zstat_07_import_86  zstat_07_import_87  zstat_07_import_88  zstat_07_import_89  zstat_07_import_90  zstat_07_import_91  zstat_07_import_92  zstat_07_import_93  zstat_07_import_94  zstat_07_import_95  zstat_07_import_96  zstat_07_import_97  zstat_07_import_99  zstat_10_export_01  zstat_10_export_02  zstat_10_export_03  zstat_10_export_04  zstat_10_export_05  zstat_10_export_06  zstat_10_export_07  zstat_10_export_08  zstat_10_export_09  zstat_10_export_10  zstat_10_export_11  zstat_10_export_12  zstat_10_export_13  zstat_10_export_14  zstat_10_export_15  zstat_10_export_16  zstat_10_export_17  zstat_10_export_18  zstat_10_export_19  zstat_10_export_20  zstat_10_export_21  zstat_10_export_22  zstat_10_export_23  zstat_10_export_24  zstat_10_export_25  zstat_10_export_26  zstat_10_export_27  zstat_10_export_2709  zstat_10_export_2710  zstat_10_export_2711  zstat_10_export_28  zstat_10_export_29  zstat_10_export_30  zstat_10_export_31  zstat_10_export_32  zstat_10_export_33  zstat_10_export_34  zstat_10_export_35  zstat_10_export_36  zstat_10_export_37  zstat_10_export_38  zstat_10_export_39  zstat_10_export_40  zstat_10_export_41  zstat_10_export_42  zstat_10_export_43  zstat_10_export_44  zstat_10_export_45  zstat_10_export_46  zstat_10_export_47  zstat_10_export_48  zstat_10_export_49  zstat_10_export_50  zstat_10_export_51  zstat_10_export_52  zstat_10_export_53  zstat_10_export_54  zstat_10_export_55  zstat_10_export_56  zstat_10_export_57  zstat_10_export_58  zstat_10_export_59  zstat_10_export_60  zstat_10_export_61  zstat_10_export_62  zstat_10_export_63  zstat_10_export_64  zstat_10_export_65  zstat_10_export_66  zstat_10_export_67  zstat_10_export_68  zstat_10_export_69  zstat_10_export_70  zstat_10_export_71  zstat_10_export_72  zstat_10_export_73  zstat_10_export_74  zstat_10_export_75  zstat_10_export_76  zstat_10_export_78  zstat_10_export_79  zstat_10_export_80  zstat_10_export_81  zstat_10_export_82  zstat_10_export_83  zstat_10_export_84  zstat_10_export_85  zstat_10_export_86  zstat_10_export_87  zstat_10_export_88  zstat_10_export_89  zstat_10_export_90  zstat_10_export_91  zstat_10_export_92  zstat_10_export_93  zstat_10_export_94  zstat_10_export_95  zstat_10_export_96  zstat_10_export_97  zstat_10_export_99  zstat_10_import_01  zstat_10_import_02  zstat_10_import_03  zstat_10_import_04  zstat_10_import_05  zstat_10_import_06  zstat_10_import_07  zstat_10_import_08  zstat_10_import_09  zstat_10_import_10  zstat_10_import_11  zstat_10_import_12  zstat_10_import_13  zstat_10_import_14  zstat_10_import_15  zstat_10_import_16  zstat_10_import_17  zstat_10_import_18  zstat_10_import_19  zstat_10_import_20  zstat_10_import_21  zstat_10_import_22  zstat_10_import_23  zstat_10_import_24  zstat_10_import_25  zstat_10_import_26  zstat_10_import_27  zstat_10_import_2709  zstat_10_import_2710  zstat_10_import_2711  zstat_10_import_28  zstat_10_import_29  zstat_10_import_30  zstat_10_import_31  zstat_10_import_32  zstat_10_import_33  zstat_10_import_34  zstat_10_import_35  zstat_10_import_36  zstat_10_import_37  zstat_10_import_38  zstat_10_import_39  zstat_10_import_40  zstat_10_import_41  zstat_10_import_42  zstat_10_import_43  zstat_10_import_44  zstat_10_import_45  zstat_10_import_46  zstat_10_import_47  zstat_10_import_48  zstat_10_import_49  zstat_10_import_50  zstat_10_import_51  zstat_10_import_52  zstat_10_import_53  zstat_10_import_54  zstat_10_import_55  zstat_10_import_56  zstat_10_import_57  zstat_10_import_58  zstat_10_import_59  zstat_10_import_60  zstat_10_import_61  zstat_10_import_62  zstat_10_import_63  zstat_10_import_64  zstat_10_import_65  zstat_10_import_66  zstat_10_import_67  zstat_10_import_68  zstat_10_import_69  zstat_10_import_70  zstat_10_import_71  zstat_10_import_72  zstat_10_import_73  zstat_10_import_74  zstat_10_import_75  zstat_10_import_76  zstat_10_import_78  zstat_10_import_79  zstat_10_import_80  zstat_10_import_81  zstat_10_import_82  zstat_10_import_83  zstat_10_import_84  zstat_10_import_85  zstat_10_import_86  zstat_10_import_87  zstat_10_import_88  zstat_10_import_89  zstat_10_import_90  zstat_10_import_91  zstat_10_import_92  zstat_10_import_93  zstat_10_import_94  zstat_10_import_95  zstat_10_import_96  zstat_10_import_97  zstat_10_import_99 , replace ignore(NA)
gen gdppc2005=gdp_2005usd/pop
gen incidence_lag1 = incidence[_n-1]
gen polstab_lag1 = polstab[_n-1]
rename incidencev414 incidence
save "maier_thesis_UNCOMTRADE_allzstats_working.dta", replace

*drop non-primary commodities
capture drop zstat_03_export_30 zstat_03_export_31 zstat_03_export_32 zstat_03_export_33 zstat_03_export_34 zstat_03_export_36 zstat_03_export_37 zstat_03_export_39 zstat_03_export_48 zstat_03_export_49 zstat_03_export_54 zstat_03_export_55 zstat_03_export_56 zstat_03_export_57 zstat_03_export_58 zstat_03_export_59 zstat_03_export_60 zstat_03_export_61 zstat_03_export_62 zstat_03_export_63 zstat_03_export_64 zstat_03_export_65 zstat_03_export_66 zstat_03_export_70 zstat_03_export_82 zstat_03_export_84 zstat_03_export_85 zstat_03_export_86 zstat_03_export_87 zstat_03_export_88 zstat_03_export_89 zstat_03_export_90 zstat_03_export_91 zstat_03_export_92 zstat_03_export_93 zstat_03_export_94 zstat_03_export_95 zstat_03_export_96 zstat_03_export_97 zstat_03_export_99 zstat_05_export_30 zstat_05_export_31 zstat_05_export_32 zstat_05_export_33 zstat_05_export_34 zstat_05_export_36 zstat_05_export_37 zstat_05_export_39 zstat_05_export_48 zstat_05_export_49 zstat_05_export_54 zstat_05_export_55 zstat_05_export_56 zstat_05_export_57 zstat_05_export_58 zstat_05_export_59 zstat_05_export_60 zstat_05_export_61 zstat_05_export_62 zstat_05_export_63 zstat_05_export_64 zstat_05_export_65 zstat_05_export_66 zstat_05_export_70 zstat_05_export_82 zstat_05_export_84 zstat_05_export_85 zstat_05_export_86 zstat_05_export_87 zstat_05_export_88 zstat_05_export_89 zstat_05_export_90 zstat_05_export_91 zstat_05_export_92 zstat_05_export_93 zstat_05_export_94 zstat_05_export_95 zstat_05_export_96 zstat_05_export_97 zstat_05_export_99 zstat_07_export_30 zstat_07_export_31 zstat_07_export_32 zstat_07_export_33 zstat_07_export_34 zstat_07_export_36 zstat_07_export_37 zstat_07_export_39 zstat_07_export_48 zstat_07_export_49 zstat_07_export_54 zstat_07_export_55 zstat_07_export_56 zstat_07_export_57 zstat_07_export_58 zstat_07_export_59 zstat_07_export_60 zstat_07_export_61 zstat_07_export_62 zstat_07_export_63 zstat_07_export_64 zstat_07_export_65 zstat_07_export_66 zstat_07_export_70 zstat_07_export_82 zstat_07_export_84 zstat_07_export_85 zstat_07_export_86 zstat_07_export_87 zstat_07_export_88 zstat_07_export_89 zstat_07_export_90 zstat_07_export_91 zstat_07_export_92 zstat_07_export_93 zstat_07_export_94 zstat_07_export_95 zstat_07_export_96 zstat_07_export_97 zstat_07_export_99 zstat_10_export_30 zstat_10_export_31 zstat_10_export_32 zstat_10_export_33 zstat_10_export_34 zstat_10_export_36 zstat_10_export_37 zstat_10_export_39 zstat_10_export_48 zstat_10_export_49 zstat_10_export_54 zstat_10_export_55 zstat_10_export_56 zstat_10_export_57 zstat_10_export_58 zstat_10_export_59 zstat_10_export_60 zstat_10_export_61 zstat_10_export_62 zstat_10_export_63 zstat_10_export_64 zstat_10_export_65 zstat_10_export_66 zstat_10_export_70 zstat_10_export_82 zstat_10_export_84 zstat_10_export_85 zstat_10_export_86 zstat_10_export_87 zstat_10_export_88 zstat_10_export_89 zstat_10_export_90 zstat_10_export_91 zstat_10_export_92 zstat_10_export_93 zstat_10_export_94 zstat_10_export_95 zstat_10_export_96 zstat_10_export_97 zstat_10_export_99 zstat_03_import_30 zstat_03_import_31 zstat_03_import_32 zstat_03_import_33 zstat_03_import_34 zstat_03_import_36 zstat_03_import_37 zstat_03_import_39 zstat_03_import_48 zstat_03_import_49 zstat_03_import_54 zstat_03_import_55 zstat_03_import_56 zstat_03_import_57 zstat_03_import_58 zstat_03_import_59 zstat_03_import_60 zstat_03_import_61 zstat_03_import_62 zstat_03_import_63 zstat_03_import_64 zstat_03_import_65 zstat_03_import_66 zstat_03_import_70 zstat_03_import_82 zstat_03_import_84 zstat_03_import_85 zstat_03_import_86 zstat_03_import_87 zstat_03_import_88 zstat_03_import_89 zstat_03_import_90 zstat_03_import_91 zstat_03_import_92 zstat_03_import_93 zstat_03_import_94 zstat_03_import_95 zstat_03_import_96 zstat_03_import_97 zstat_03_import_99 zstat_05_import_30 zstat_05_import_31 zstat_05_import_32 zstat_05_import_33 zstat_05_import_34 zstat_05_import_36 zstat_05_import_37 zstat_05_import_39 zstat_05_import_48 zstat_05_import_49 zstat_05_import_54 zstat_05_import_55 zstat_05_import_56 zstat_05_import_57 zstat_05_import_58 zstat_05_import_59 zstat_05_import_60 zstat_05_import_61 zstat_05_import_62 zstat_05_import_63 zstat_05_import_64 zstat_05_import_65 zstat_05_import_66 zstat_05_import_70 zstat_05_import_82 zstat_05_import_84 zstat_05_import_85 zstat_05_import_86 zstat_05_import_87 zstat_05_import_88 zstat_05_import_89 zstat_05_import_90 zstat_05_import_91 zstat_05_import_92 zstat_05_import_93 zstat_05_import_94 zstat_05_import_95 zstat_05_import_96 zstat_05_import_97 zstat_05_import_99 zstat_07_import_30 zstat_07_import_31 zstat_07_import_32 zstat_07_import_33 zstat_07_import_34 zstat_07_import_36 zstat_07_import_37 zstat_07_import_39 zstat_07_import_48 zstat_07_import_49 zstat_07_import_54 zstat_07_import_55 zstat_07_import_56 zstat_07_import_57 zstat_07_import_58 zstat_07_import_59 zstat_07_import_60 zstat_07_import_61 zstat_07_import_62 zstat_07_import_63 zstat_07_import_64 zstat_07_import_65 zstat_07_import_66 zstat_07_import_70 zstat_07_import_82 zstat_07_import_84 zstat_07_import_85 zstat_07_import_86 zstat_07_import_87 zstat_07_import_88 zstat_07_import_89 zstat_07_import_90 zstat_07_import_91 zstat_07_import_92 zstat_07_import_93 zstat_07_import_94 zstat_07_import_95 zstat_07_import_96 zstat_07_import_97 zstat_07_import_99 zstat_10_import_30 zstat_10_import_31 zstat_10_import_32 zstat_10_import_33 zstat_10_import_34 zstat_10_import_36 zstat_10_import_37 zstat_10_import_39 zstat_10_import_48 zstat_10_import_49 zstat_10_import_54 zstat_10_import_55 zstat_10_import_56 zstat_10_import_57 zstat_10_import_58 zstat_10_import_59 zstat_10_import_60 zstat_10_import_61 zstat_10_import_62 zstat_10_import_63 zstat_10_import_64 zstat_10_import_65 zstat_10_import_66 zstat_10_import_70 zstat_10_import_82 zstat_10_import_84 zstat_10_import_85 zstat_10_import_86 zstat_10_import_87 zstat_10_import_88 zstat_10_import_89 zstat_10_import_90 zstat_10_import_91 zstat_10_import_92 zstat_10_import_93 zstat_10_import_94 zstat_10_import_95 zstat_10_import_96 zstat_10_import_97 zstat_10_import_99

*create various globals that can be plugged into the regressions
global zstats_exports zstat_03_export_01 zstat_03_export_02 zstat_03_export_03 zstat_03_export_04 zstat_03_export_05 zstat_03_export_06 zstat_03_export_07 zstat_03_export_08 zstat_03_export_09 zstat_03_export_10 zstat_03_export_11 zstat_03_export_12 zstat_03_export_13 zstat_03_export_14 zstat_03_export_15 zstat_03_export_16 zstat_03_export_17 zstat_03_export_18 zstat_03_export_19 zstat_03_export_20 zstat_03_export_21 zstat_03_export_22 zstat_03_export_23 zstat_03_export_24 zstat_03_export_25 zstat_03_export_26 zstat_03_export_27 zstat_03_export_2709 zstat_03_export_2710 zstat_03_export_2711 zstat_03_export_28 zstat_03_export_29 zstat_03_export_35 zstat_03_export_38 zstat_03_export_40 zstat_03_export_41 zstat_03_export_42 zstat_03_export_43 zstat_03_export_44 zstat_03_export_45 zstat_03_export_46 zstat_03_export_47 zstat_03_export_50 zstat_03_export_51 zstat_03_export_52 zstat_03_export_53 zstat_03_export_67 zstat_03_export_68 zstat_03_export_69 zstat_03_export_71 zstat_03_export_72 zstat_03_export_73 zstat_03_export_74 zstat_03_export_75 zstat_03_export_76 zstat_03_export_78 zstat_03_export_79 zstat_03_export_80 zstat_03_export_81 zstat_03_export_83 zstat_05_export_01 zstat_05_export_02 zstat_05_export_03 zstat_05_export_04 zstat_05_export_05 zstat_05_export_06 zstat_05_export_07 zstat_05_export_08 zstat_05_export_09 zstat_05_export_10 zstat_05_export_11 zstat_05_export_12 zstat_05_export_13 zstat_05_export_14 zstat_05_export_15 zstat_05_export_16 zstat_05_export_17 zstat_05_export_18 zstat_05_export_19 zstat_05_export_20 zstat_05_export_21 zstat_05_export_22 zstat_05_export_23 zstat_05_export_24 zstat_05_export_25 zstat_05_export_26 zstat_05_export_27 zstat_05_export_2709 zstat_05_export_2710 zstat_05_export_2711 zstat_05_export_28 zstat_05_export_29 zstat_05_export_35 zstat_05_export_38 zstat_05_export_40 zstat_05_export_41 zstat_05_export_42 zstat_05_export_43 zstat_05_export_44 zstat_05_export_45 zstat_05_export_46 zstat_05_export_47 zstat_05_export_50 zstat_05_export_51 zstat_05_export_52 zstat_05_export_53 zstat_05_export_67 zstat_05_export_68 zstat_05_export_69 zstat_05_export_71 zstat_05_export_72 zstat_05_export_73 zstat_05_export_74 zstat_05_export_75 zstat_05_export_76 zstat_05_export_78 zstat_05_export_79 zstat_05_export_80 zstat_05_export_81 zstat_05_export_83 zstat_07_export_01 zstat_07_export_02 zstat_07_export_03 zstat_07_export_04 zstat_07_export_05 zstat_07_export_06 zstat_07_export_07 zstat_07_export_08 zstat_07_export_09 zstat_07_export_10 zstat_07_export_11 zstat_07_export_12 zstat_07_export_13 zstat_07_export_14 zstat_07_export_15 zstat_07_export_16 zstat_07_export_17 zstat_07_export_18 zstat_07_export_19 zstat_07_export_20 zstat_07_export_21 zstat_07_export_22 zstat_07_export_23 zstat_07_export_24 zstat_07_export_25 zstat_07_export_26 zstat_07_export_27 zstat_07_export_2709 zstat_07_export_2710 zstat_07_export_2711 zstat_07_export_28 zstat_07_export_29 zstat_07_export_35 zstat_07_export_38 zstat_07_export_40 zstat_07_export_41 zstat_07_export_42 zstat_07_export_43 zstat_07_export_44 zstat_07_export_45 zstat_07_export_46 zstat_07_export_47 zstat_07_export_50 zstat_07_export_51 zstat_07_export_52 zstat_07_export_53 zstat_07_export_67 zstat_07_export_68 zstat_07_export_69 zstat_07_export_71 zstat_07_export_72 zstat_07_export_73 zstat_07_export_74 zstat_07_export_75 zstat_07_export_76 zstat_07_export_78 zstat_07_export_79 zstat_07_export_80 zstat_07_export_81 zstat_07_export_83

*build list of regressors that don't have too many missing variables
global regressors 
global potential_regressors $zstats_exports


*change the last term in foreach to switch which commodity data is used
foreach z in $potential_regressors {
	display "`z'"
	count
	*define number of observations that can be missing = r(N)/3, i.e. two thirds can be missing
	*requiring no less than 1/3 missing yields 59 vars
	scalar ns=r(N)/2
	count if `z'==.
	scalar num_missing=r(N)
	if num_missing<= ns{
		display "in"
		global newvars `z'
		*this builds list of regressors in global $regressors
		global regressors: list global(regressors)| global(newvars)
	}
}
*display $regressors 
save "maier_thesis_UNCOMTRADE_allzstats_working.dta", replace

*******************
*lasso regression
*create copy of data to populate
save "lasso_results.dta", replace
use "maier_thesis_UNCOMTRADE_allzstats_working.dta", clear

program lass_train
	preserve
	*sample 80% of data
	gen random = runiform()
	gen training=0
	replace training=1 if random<=.80
	sort training
	
	*lasso regression usign lars package
	lars polstab $regressors if training==1, algorithm(lasso) gopt(legend(off))
	
	tempfile temp_results
	
	***instead of postfile, what about simply appending to another .dta?	
	*get betas
	matrix betas=r(beta)
	
	*get R-sq values
	matrix r2=r(R2)
	matrix cp=r(cp)
	
	*transpose variables
	matrix r2=r2'
	matrix cp=cp'
	svmat r2
	svmat cp
	
	*cp_min is number of step that performed mest
	sum cp1
	*find cp of the best performing model
	scalar cp_min=r(min)
	
	
	*rename betas so that they have z-stat name in title, not just beta1 beta2 etc.
	svmat betas
	scalar c=1
	foreach x in $regressors{
		display "beta_`x'"
		local i=scalar(c)
		rename betas`i' beta_`x'
		scalar c=c+1
	}
	
	*only keep observation row with the best CP score!
	keep cp1 r21 beta*
	keep if cp==r(min)

	ds
	global vars_=r(varlist)
	save temp_results, replace
	use lasso_results, clear
	*drop variables not from the simulations
	capture drop v1 year reporteriso reportercode wba3 gdp_2005usd prioiso priocode reporter pop lpop incidence newconflictinyearv414 numbrofyearsonsetv414 onset1v414 onset2v414 onset5v414 onset8v414 onset20v414 maxintyearv414 noterrconfv414 nogovconfv414 nototconfv414 govonlyv414 terronlyv414 bothgovterrv414 sumconfv414 elf1 pol1 fh_status pts_amn pts_ussd cyear country flag fragment democ autoc polity polity2 durable terrorbomb_deaths z_index_03_export z_index_05_export z_index_07_export z_index_10_export z_index_03_import z_index_05_import z_index_07_import z_index_10_import polstab ruleoflaw zstat_03_export_01 zstat_03_export_02 zstat_03_export_03 zstat_03_export_04 zstat_03_export_05 zstat_03_export_06 zstat_03_export_07 zstat_03_export_08 zstat_03_export_09 zstat_03_export_10 zstat_03_export_11 zstat_03_export_12 zstat_03_export_13 zstat_03_export_14 zstat_03_export_15 zstat_03_export_16 zstat_03_export_17 zstat_03_export_18 zstat_03_export_19 zstat_03_export_20 zstat_03_export_21 zstat_03_export_22 zstat_03_export_23 zstat_03_export_24 zstat_03_export_25 zstat_03_export_26 zstat_03_export_27 zstat_03_export_2709 zstat_03_export_2710 zstat_03_export_2711 zstat_03_export_28 zstat_03_export_29 zstat_03_export_30 zstat_03_export_31 zstat_03_export_32 zstat_03_export_33 zstat_03_export_34 zstat_03_export_35 zstat_03_export_36 zstat_03_export_37 zstat_03_export_38 zstat_03_export_39 zstat_03_export_40 zstat_03_export_41 zstat_03_export_42 zstat_03_export_43 zstat_03_export_44 zstat_03_export_45 zstat_03_export_46 zstat_03_export_47 zstat_03_export_48 zstat_03_export_49 zstat_03_export_50 zstat_03_export_51 zstat_03_export_52 zstat_03_export_53 zstat_03_export_54 zstat_03_export_55 zstat_03_export_56 zstat_03_export_57 zstat_03_export_58 zstat_03_export_59 zstat_03_export_60 zstat_03_export_61 zstat_03_export_62 zstat_03_export_63 zstat_03_export_64 zstat_03_export_65 zstat_03_export_66 zstat_03_export_67 zstat_03_export_68 zstat_03_export_69 zstat_03_export_70 zstat_03_export_71 zstat_03_export_72 zstat_03_export_73 zstat_03_export_74 zstat_03_export_75 zstat_03_export_76 zstat_03_export_78 zstat_03_export_79 zstat_03_export_80 zstat_03_export_81 zstat_03_export_82 zstat_03_export_83 zstat_03_export_84 zstat_03_export_85 zstat_03_export_86 zstat_03_export_87 zstat_03_export_88 zstat_03_export_89 zstat_03_export_90 zstat_03_export_91 zstat_03_export_92 zstat_03_export_93 zstat_03_export_94 zstat_03_export_95 zstat_03_export_96 zstat_03_export_97 zstat_03_export_99 zstat_03_import_01 zstat_03_import_02 zstat_03_import_03 zstat_03_import_04 zstat_03_import_05 zstat_03_import_06 zstat_03_import_07 zstat_03_import_08 zstat_03_import_09 zstat_03_import_10 zstat_03_import_11 zstat_03_import_12 zstat_03_import_13 zstat_03_import_14 zstat_03_import_15 zstat_03_import_16 zstat_03_import_17 zstat_03_import_18 zstat_03_import_19 zstat_03_import_20 zstat_03_import_21 zstat_03_import_22 zstat_03_import_23 zstat_03_import_24 zstat_03_import_25 zstat_03_import_26 zstat_03_import_27 zstat_03_import_2709 zstat_03_import_2710 zstat_03_import_2711 zstat_03_import_28 zstat_03_import_29 zstat_03_import_30 zstat_03_import_31 zstat_03_import_32 zstat_03_import_33 zstat_03_import_34 zstat_03_import_35 zstat_03_import_36 zstat_03_import_37 zstat_03_import_38 zstat_03_import_39 zstat_03_import_40 zstat_03_import_41 zstat_03_import_42 zstat_03_import_43 zstat_03_import_44 zstat_03_import_45 zstat_03_import_46 zstat_03_import_47 zstat_03_import_48 zstat_03_import_49 zstat_03_import_50 zstat_03_import_51 zstat_03_import_52 zstat_03_import_53 zstat_03_import_54 zstat_03_import_55 zstat_03_import_56 zstat_03_import_57 zstat_03_import_58 zstat_03_import_59 zstat_03_import_60 zstat_03_import_61 zstat_03_import_62 zstat_03_import_63 zstat_03_import_64 zstat_03_import_65 zstat_03_import_66 zstat_03_import_67 zstat_03_import_68 zstat_03_import_69 zstat_03_import_70 zstat_03_import_71 zstat_03_import_72 zstat_03_import_73 zstat_03_import_74 zstat_03_import_75 zstat_03_import_76 zstat_03_import_78 zstat_03_import_79 zstat_03_import_80 zstat_03_import_81 zstat_03_import_82 zstat_03_import_83 zstat_03_import_84 zstat_03_import_85 zstat_03_import_86 zstat_03_import_87 zstat_03_import_88 zstat_03_import_89 zstat_03_import_90 zstat_03_import_91 zstat_03_import_92 zstat_03_import_93 zstat_03_import_94 zstat_03_import_95 zstat_03_import_96 zstat_03_import_97 zstat_03_import_99 zstat_05_export_01 zstat_05_export_02 zstat_05_export_03 zstat_05_export_04 zstat_05_export_05 zstat_05_export_06 zstat_05_export_07 zstat_05_export_08 zstat_05_export_09 zstat_05_export_10 zstat_05_export_11 zstat_05_export_12 zstat_05_export_13 zstat_05_export_14 zstat_05_export_15 zstat_05_export_16 zstat_05_export_17 zstat_05_export_18 zstat_05_export_19 zstat_05_export_20 zstat_05_export_21 zstat_05_export_22 zstat_05_export_23 zstat_05_export_24 zstat_05_export_25 zstat_05_export_26 zstat_05_export_27 zstat_05_export_2709 zstat_05_export_2710 zstat_05_export_2711 zstat_05_export_28 zstat_05_export_29 zstat_05_export_30 zstat_05_export_31 zstat_05_export_32 zstat_05_export_33 zstat_05_export_34 zstat_05_export_35 zstat_05_export_36 zstat_05_export_37 zstat_05_export_38 zstat_05_export_39 zstat_05_export_40 zstat_05_export_41 zstat_05_export_42 zstat_05_export_43 zstat_05_export_44 zstat_05_export_45 zstat_05_export_46 zstat_05_export_47 zstat_05_export_48 zstat_05_export_49 zstat_05_export_50 zstat_05_export_51 zstat_05_export_52 zstat_05_export_53 zstat_05_export_54 zstat_05_export_55 zstat_05_export_56 zstat_05_export_57 zstat_05_export_58 zstat_05_export_59 zstat_05_export_60 zstat_05_export_61 zstat_05_export_62 zstat_05_export_63 zstat_05_export_64 zstat_05_export_65 zstat_05_export_66 zstat_05_export_67 zstat_05_export_68 zstat_05_export_69 zstat_05_export_70 zstat_05_export_71 zstat_05_export_72 zstat_05_export_73 zstat_05_export_74 zstat_05_export_75 zstat_05_export_76 zstat_05_export_78 zstat_05_export_79 zstat_05_export_80 zstat_05_export_81 zstat_05_export_82 zstat_05_export_83 zstat_05_export_84 zstat_05_export_85 zstat_05_export_86 zstat_05_export_87 zstat_05_export_88 zstat_05_export_89 zstat_05_export_90 zstat_05_export_91 zstat_05_export_92 zstat_05_export_93 zstat_05_export_94 zstat_05_export_95 zstat_05_export_96 zstat_05_export_97 zstat_05_export_99 zstat_05_import_01 zstat_05_import_02 zstat_05_import_03 zstat_05_import_04 zstat_05_import_05 zstat_05_import_06 zstat_05_import_07 zstat_05_import_08 zstat_05_import_09 zstat_05_import_10 zstat_05_import_11 zstat_05_import_12 zstat_05_import_13 zstat_05_import_14 zstat_05_import_15 zstat_05_import_16 zstat_05_import_17 zstat_05_import_18 zstat_05_import_19 zstat_05_import_20 zstat_05_import_21 zstat_05_import_22 zstat_05_import_23 zstat_05_import_24 zstat_05_import_25 zstat_05_import_26 zstat_05_import_27 zstat_05_import_2709 zstat_05_import_2710 zstat_05_import_2711 zstat_05_import_28 zstat_05_import_29 zstat_05_import_30 zstat_05_import_31 zstat_05_import_32 zstat_05_import_33 zstat_05_import_34 zstat_05_import_35 zstat_05_import_36 zstat_05_import_37 zstat_05_import_38 zstat_05_import_39 zstat_05_import_40 zstat_05_import_41 zstat_05_import_42 zstat_05_import_43 zstat_05_import_44 zstat_05_import_45 zstat_05_import_46 zstat_05_import_47 zstat_05_import_48 zstat_05_import_49 zstat_05_import_50 zstat_05_import_51 zstat_05_import_52 zstat_05_import_53 zstat_05_import_54 zstat_05_import_55 zstat_05_import_56 zstat_05_import_57 zstat_05_import_58 zstat_05_import_59 zstat_05_import_60 zstat_05_import_61 zstat_05_import_62 zstat_05_import_63 zstat_05_import_64 zstat_05_import_65 zstat_05_import_66 zstat_05_import_67 zstat_05_import_68 zstat_05_import_69 zstat_05_import_70 zstat_05_import_71 zstat_05_import_72 zstat_05_import_73 zstat_05_import_74 zstat_05_import_75 zstat_05_import_76 zstat_05_import_78 zstat_05_import_79 zstat_05_import_80 zstat_05_import_81 zstat_05_import_82 zstat_05_import_83 zstat_05_import_84 zstat_05_import_85 zstat_05_import_86 zstat_05_import_87 zstat_05_import_88 zstat_05_import_89 zstat_05_import_90 zstat_05_import_91 zstat_05_import_92 zstat_05_import_93 zstat_05_import_94 zstat_05_import_95 zstat_05_import_96 zstat_05_import_97 zstat_05_import_99 zstat_07_export_01 zstat_07_export_02 zstat_07_export_03 zstat_07_export_04 zstat_07_export_05 zstat_07_export_06 zstat_07_export_07 zstat_07_export_08 zstat_07_export_09 zstat_07_export_10 zstat_07_export_11 zstat_07_export_12 zstat_07_export_13 zstat_07_export_14 zstat_07_export_15 zstat_07_export_16 zstat_07_export_17 zstat_07_export_18 zstat_07_export_19 zstat_07_export_20 zstat_07_export_21 zstat_07_export_22 zstat_07_export_23 zstat_07_export_24 zstat_07_export_25 zstat_07_export_26 zstat_07_export_27 zstat_07_export_2709 zstat_07_export_2710 zstat_07_export_2711 zstat_07_export_28 zstat_07_export_29 zstat_07_export_30 zstat_07_export_31 zstat_07_export_32 zstat_07_export_33 zstat_07_export_34 zstat_07_export_35 zstat_07_export_36 zstat_07_export_37 zstat_07_export_38 zstat_07_export_39 zstat_07_export_40 zstat_07_export_41 zstat_07_export_42 zstat_07_export_43 zstat_07_export_44 zstat_07_export_45 zstat_07_export_46 zstat_07_export_47 zstat_07_export_48 zstat_07_export_49 zstat_07_export_50 zstat_07_export_51 zstat_07_export_52 zstat_07_export_53 zstat_07_export_54 zstat_07_export_55 zstat_07_export_56 zstat_07_export_57 zstat_07_export_58 zstat_07_export_59 zstat_07_export_60 zstat_07_export_61 zstat_07_export_62 zstat_07_export_63 zstat_07_export_64 zstat_07_export_65 zstat_07_export_66 zstat_07_export_67 zstat_07_export_68 zstat_07_export_69 zstat_07_export_70 zstat_07_export_71 zstat_07_export_72 zstat_07_export_73 zstat_07_export_74 zstat_07_export_75 zstat_07_export_76 zstat_07_export_78 zstat_07_export_79 zstat_07_export_80 zstat_07_export_81 zstat_07_export_82 zstat_07_export_83 zstat_07_export_84 zstat_07_export_85 zstat_07_export_86 zstat_07_export_87 zstat_07_export_88 zstat_07_export_89 zstat_07_export_90 zstat_07_export_91 zstat_07_export_92 zstat_07_export_93 zstat_07_export_94 zstat_07_export_95 zstat_07_export_96 zstat_07_export_97 zstat_07_export_99 zstat_07_import_01 zstat_07_import_02 zstat_07_import_03 zstat_07_import_04 zstat_07_import_05 zstat_07_import_06 zstat_07_import_07 zstat_07_import_08 zstat_07_import_09 zstat_07_import_10 zstat_07_import_11 zstat_07_import_12 zstat_07_import_13 zstat_07_import_14 zstat_07_import_15 zstat_07_import_16 zstat_07_import_17 zstat_07_import_18 zstat_07_import_19 zstat_07_import_20 zstat_07_import_21 zstat_07_import_22 zstat_07_import_23 zstat_07_import_24 zstat_07_import_25 zstat_07_import_26 zstat_07_import_27 zstat_07_import_2709 zstat_07_import_2710 zstat_07_import_2711 zstat_07_import_28 zstat_07_import_29 zstat_07_import_30 zstat_07_import_31 zstat_07_import_32 zstat_07_import_33 zstat_07_import_34 zstat_07_import_35 zstat_07_import_36 zstat_07_import_37 zstat_07_import_38 zstat_07_import_39 zstat_07_import_40 zstat_07_import_41 zstat_07_import_42 zstat_07_import_43 zstat_07_import_44 zstat_07_import_45 zstat_07_import_46 zstat_07_import_47 zstat_07_import_48 zstat_07_import_49 zstat_07_import_50 zstat_07_import_51 zstat_07_import_52 zstat_07_import_53 zstat_07_import_54 zstat_07_import_55 zstat_07_import_56 zstat_07_import_57 zstat_07_import_58 zstat_07_import_59 zstat_07_import_60 zstat_07_import_61 zstat_07_import_62 zstat_07_import_63 zstat_07_import_64 zstat_07_import_65 zstat_07_import_66 zstat_07_import_67 zstat_07_import_68 zstat_07_import_69 zstat_07_import_70 zstat_07_import_71 zstat_07_import_72 zstat_07_import_73 zstat_07_import_74 zstat_07_import_75 zstat_07_import_76 zstat_07_import_78 zstat_07_import_79 zstat_07_import_80 zstat_07_import_81 zstat_07_import_82 zstat_07_import_83 zstat_07_import_84 zstat_07_import_85 zstat_07_import_86 zstat_07_import_87 zstat_07_import_88 zstat_07_import_89 zstat_07_import_90 zstat_07_import_91 zstat_07_import_92 zstat_07_import_93 zstat_07_import_94 zstat_07_import_95 zstat_07_import_96 zstat_07_import_97 zstat_07_import_99 zstat_10_export_01 zstat_10_export_02 zstat_10_export_03 zstat_10_export_04 zstat_10_export_05 zstat_10_export_06 zstat_10_export_07 zstat_10_export_08 zstat_10_export_09 zstat_10_export_10 zstat_10_export_11 zstat_10_export_12 zstat_10_export_13 zstat_10_export_14 zstat_10_export_15 zstat_10_export_16 zstat_10_export_17 zstat_10_export_18 zstat_10_export_19 zstat_10_export_20 zstat_10_export_21 zstat_10_export_22 zstat_10_export_23 zstat_10_export_24 zstat_10_export_25 zstat_10_export_26 zstat_10_export_27 zstat_10_export_2709 zstat_10_export_2710 zstat_10_export_2711 zstat_10_export_28 zstat_10_export_29 zstat_10_export_30 zstat_10_export_31 zstat_10_export_32 zstat_10_export_33 zstat_10_export_34 zstat_10_export_35 zstat_10_export_36 zstat_10_export_37 zstat_10_export_38 zstat_10_export_39 zstat_10_export_40 zstat_10_export_41 zstat_10_export_42 zstat_10_export_43 zstat_10_export_44 zstat_10_export_45 zstat_10_export_46 zstat_10_export_47 zstat_10_export_48 zstat_10_export_49 zstat_10_export_50 zstat_10_export_51 zstat_10_export_52 zstat_10_export_53 zstat_10_export_54 zstat_10_export_55 zstat_10_export_56 zstat_10_export_57 zstat_10_export_58 zstat_10_export_59 zstat_10_export_60 zstat_10_export_61 zstat_10_export_62 zstat_10_export_63 zstat_10_export_64 zstat_10_export_65 zstat_10_export_66 zstat_10_export_67 zstat_10_export_68 zstat_10_export_69 zstat_10_export_70 zstat_10_export_71 zstat_10_export_72 zstat_10_export_73 zstat_10_export_74 zstat_10_export_75 zstat_10_export_76 zstat_10_export_78 zstat_10_export_79 zstat_10_export_80 zstat_10_export_81 zstat_10_export_82 zstat_10_export_83 zstat_10_export_84 zstat_10_export_85 zstat_10_export_86 zstat_10_export_87 zstat_10_export_88 zstat_10_export_89 zstat_10_export_90 zstat_10_export_91 zstat_10_export_92 zstat_10_export_93 zstat_10_export_94 zstat_10_export_95 zstat_10_export_96 zstat_10_export_97 zstat_10_export_99 zstat_10_import_01 zstat_10_import_02 zstat_10_import_03 zstat_10_import_04 zstat_10_import_05 zstat_10_import_06 zstat_10_import_07 zstat_10_import_08 zstat_10_import_09 zstat_10_import_10 zstat_10_import_11 zstat_10_import_12 zstat_10_import_13 zstat_10_import_14 zstat_10_import_15 zstat_10_import_16 zstat_10_import_17 zstat_10_import_18 zstat_10_import_19 zstat_10_import_20 zstat_10_import_21 zstat_10_import_22 zstat_10_import_23 zstat_10_import_24 zstat_10_import_25 zstat_10_import_26 zstat_10_import_27 zstat_10_import_2709 zstat_10_import_2710 zstat_10_import_2711 zstat_10_import_28 zstat_10_import_29 zstat_10_import_30 zstat_10_import_31 zstat_10_import_32 zstat_10_import_33 zstat_10_import_34 zstat_10_import_35 zstat_10_import_36 zstat_10_import_37 zstat_10_import_38 zstat_10_import_39 zstat_10_import_40 zstat_10_import_41 zstat_10_import_42 zstat_10_import_43 zstat_10_import_44 zstat_10_import_45 zstat_10_import_46 zstat_10_import_47 zstat_10_import_48 zstat_10_import_49 zstat_10_import_50 zstat_10_import_51 zstat_10_import_52 zstat_10_import_53 zstat_10_import_54 zstat_10_import_55 zstat_10_import_56 zstat_10_import_57 zstat_10_import_58 zstat_10_import_59 zstat_10_import_60 zstat_10_import_61 zstat_10_import_62 zstat_10_import_63 zstat_10_import_64 zstat_10_import_65 zstat_10_import_66 zstat_10_import_67 zstat_10_import_68 zstat_10_import_69 zstat_10_import_70 zstat_10_import_71 zstat_10_import_72 zstat_10_import_73 zstat_10_import_74 zstat_10_import_75 zstat_10_import_76 zstat_10_import_78 zstat_10_import_79 zstat_10_import_80 zstat_10_import_81 zstat_10_import_82 zstat_10_import_83 zstat_10_import_84 zstat_10_import_85 zstat_10_import_86 zstat_10_import_87 zstat_10_import_88 zstat_10_import_89 zstat_10_import_90 zstat_10_import_91 zstat_10_import_92 zstat_10_import_93 zstat_10_import_94 zstat_10_import_95 zstat_10_import_96 zstat_10_import_97 zstat_10_import_99 gdppc2005 incidence_lag1 polstab_lag1
	append using temp_results
	
	save lasso_results, replace
	
	restore
end
simulate, reps(1000): lass_train



******************
*plot results from lasso (average regressors with p-values)
use lasso_results, clear
keep cp1 r21 beta*
order _all, alpha
gen model = _n
order model

drop model r21 cp1
*delete empty observations
drop if missing(beta_zstat_03_export_01)
*drop betas that always were zero and whose confidence intervals overlap 0
ds
global vars=r(varlist)
foreach var_ in $vars {
	*fund number of times included 
	quietly sum `var_' if `var_'==0
	local misses=r(N)/_N
	display `misses'
	*get mean
	quietly sum `var_'
	*find margin of error at 90% CI, i.e., at 1.645 critical p
	local sum_=r(sum)
	local mean_=r(mean)
	local upper=r(mean)+1.645*r(sd)
	local lower=r(mean)-1.645*r(sd)
	*drop if more than 80% misses. 
	if `sum_'==0 | `misses'>0.8{
		drop `var_'
	}
	*drop if beta ci overlaps zero
	else if `mean_'>0 & `lower'<=0{
		drop `var_'
	}
	else if `mean_'<0 & `upper'>=0{
		drop `var_'
	}
}

*graph betas
ds
global beta_vars=r(varlist)
graph hbox $beta_vars, noout boxgap(30) legend(off) showyvars ///
	ytitle(Estimated Beta) yline(0, lpattern(dash)) yline(-.2 -.1 .1 .2, lpattern(dot)) ylabel(,labsize(med))
*resize graph
graph display, ysize(10) xsize(6)
graph save  box_estimated_betas_lasso, replace

dotplot $beta_vars, center xlabel(, angle(vertical)) yline(-.2 -.1 .1 .2, lpattern(dot)) ///
	yline(0, lpattern(dash)) msize(tiny) ytitle(Estimated Beta)
graph display, ysize(6) xsize(10)
graph save box_estimated_betas_dots, replace

estpost summarize
esttab using "maier_lasso_results_08April2016.xls",replace cells("count mean sd min max") label title(Table 1:Summary statistics)

*put average betas into matrix
ds 
global vars=r(varlist)
mean $vars
matrix beta_means=e(b)
save lasso_results_truncated, replace

*use matrix score to generate predicted scores
use "maier_thesis_UNCOMTRADE_allzstats_working.dta", clear
xtset reportercode year, y
ds
global vars=r(vars)
*beta_vars has the list of beta varnames
*create varlist with source data to be multiplied by beta matrix
global included_vars 
foreach var_ in $beta_vars{
	*display "`var_'"
	display substr("`var_'",6,22)
	local i=substr("`var_'",6,22)
	global temp `i'
	global included_vars : list global(temp) | global(included_vars)
	*display "`sub'"
}

global included_vars: list sort global(included_vars)
 
*because biases estimates down for places with missing data
scalar c=1
global hats
foreach var_ in $included_vars{
	local i=scalar(c)
	local b=beta_means[1,c]
	gen hat`i'=`var_'*`b'
	*rename hat`i' hat 
	scalar c=c+1
	global hat_ hat`i'
	global hats : list global(hats) | global(hat_)
}
sum polstab
gen polstab_mean=r(mean)
egen polstab_hat_lasso=rowtotal($hats), missing
*convert polstab_hat_lasso 0 values to missing so e
replace polstab_hat_lasso=. if polstab_hat_lasso==0

drop hat*
gen errors_lasso=polstab_hat_lasso-polstab 

*get xtreg with selected variables
xtreg polstab gdppc2005 elf1 pol1 lpop  polity $included_vars, fe robust
predict polstab_hat_xtreg
scalar r2_xtreg=e(r2)
putexcel A1=matrix(r(table), names) using maier_thesis_lasso_xtreg_results, replace

*baseline
*xtreg polstab gdppc2005 elf1 pol1 lpop  polity , fe robust

eststo: quietly xtreg polstab gdppc2005 elf1 pol1 lpop  polity, fe robust
*eststo: lars polstab gdppc2005 elf1 pol1 lpop  polity, a(lasso)
eststo: xtreg polstab gdppc2005 elf1 pol1 lpop  polity $included_vars, fe 
esttab

gen errors_xtreg=polstab_hat_xtreg-polstab

*get baseline regression with just controls for comparison
xtreg polstab gdppc2005 elf1 pol1 lpop  polity, fe robust
predict polstab_hat_controls
gen errors_controls=polstab_hat_controls-polstab

*plot kdensities of polstab hat vs polstab
twoway (kdensity polstab) (kdensity polstab_hat_xtreg), title("Distributions of Model-Predicted and Actual Political Stability")
graph save kdensity_predicted_xtreg, replace
twoway (kdensity polstab) (kdensity polstab_hat_controls), title("Distributions of Control-Predicted and Actual Political Stability")
graph save kdensity_predicted_controls, replace

*squared residuals (for SSR)
gen sq_errors_lasso=errors_lasso^2
gen sq_errors_controls=errors_controls^2

summarize sq_errors_lasso
scalar ssr_lasso=r(sum)
summarize sq_errors_controls
scalar ssr_controls=r(sum)

*squared explained (for SSE) predicted minus average
summarize polstab
scalar polstab_mean = r(mean)

gen explained_lasso=(polstab_hat_lasso-scalar(polstab_mean))^2
gen explained_controls=(polstab_hat_controls-scalar(polstab_mean))^2

summarize explained_lasso
scalar sse_lasso=r(sum)
summarize explained_controls
scalar sse_controls=r(sum)

*squares (for SST)
gen sq_var_polstab=(polstab-scalar(polstab_mean))^2
summarize sq_var_polstab
scalar sst_polstab=r(sum)

*display R-sq calculated by hand
display(sse_lasso/sst_polstab)
display scalar(r2_xtreg)
display(sse_controls/sst_polstab)

*out graphs
scatter errors_lasso errors_controls, msize(vsmall)
graph save error_correlations_lasso_vscontrol, replace
scatter errors_xtreg errors_controls, msize(vsmall)
graph save error_correlations_xtreg_vscontrol, replace


*check how the errors are distributed
scatter errors_lasso polstab, yscale(range(-2 3)) msize(vsmall) title("Political Stability Scores versus Prediction Errors (lasso model)") xtitle("Political Stability Score") ytitle("Error") legend(off)
graph save errors_lasso_vs_polstab, replace

scatter errors_xtreg polstab, yscale(range(-2 3)) msize(vsmall) title("Political Stability Scores versus Prediction Errors (full model)") xtitle("Political Stability Score") ytitle("Error") legend(off)
graph save errors_xtreg_vs_polstab, replace

scatter errors_controls polstab, yscale(range(-2 3)) msize(vsmall) title("Political Stability Scores versus Prediction Errors (control model)") xtitle("Political Stability Score") ytitle("Error") legend(off)
graph save errors_controls_vs_polstab, replace

kdensity errors_xtreg, normal title("Distribution of Errors versus Normal Distribution") ytitle("Kernel Density") xtitle("Error")
graph save errors_xtreg_kdensity, replace

lpoly errors_lasso polstab, ci level(95) yscale(range(-2 3)) msize(vsmall) title("Political Stability Scores versus Prediction Errors (lasso model)") xtitle("Political Stability Score") ytitle("Error") legend(off)
lpoly errors_xtreg polstab, ci level(95) yscale(range(-2 3)) msize(vsmall) title("Political Stability Scores versus Prediction Errors (full model)") xtitle("Political Stability Score") ytitle("Error") legend(off)
lpoly errors_controls polstab, ci level(95) yscale(range(-2 3)) msize(vsmall) title("Political Stability Scores versus Prediction Errors (controls)") xtitle("Political Stability Score") ytitle("Error") legend(off)

**print lasso simulations results (needs to go after error analysis)
use lasso_results_truncated, clear
ds 
global vars=r(varlist)
mean $vars
*print data on betas to excel
putexcel A1=matrix(r(table), names) using maier_thesis_lasso_beta_sums, replace





*the following needs to be edited so that it differentiates between vars with
*positive and negative beats

******************
*subset pct_gdp data for country vulnerability analysis
use maier_thesis_UNCOMTRADE_pct_gdp, clear
xtset reportercode year, y

**if switching to imports, need to change throughout this section of code
global pct_exports  pctgdp_export_01 pctgdp_export_02 pctgdp_export_03 pctgdp_export_04 pctgdp_export_05 pctgdp_export_06 pctgdp_export_07 pctgdp_export_08 pctgdp_export_09 pctgdp_export_10 pctgdp_export_11 pctgdp_export_12 pctgdp_export_13 pctgdp_export_14 pctgdp_export_15 pctgdp_export_16 pctgdp_export_17 pctgdp_export_18 pctgdp_export_19 pctgdp_export_20 pctgdp_export_21 pctgdp_export_22 pctgdp_export_23 pctgdp_export_24 pctgdp_export_25 pctgdp_export_26 pctgdp_export_27 pctgdp_export_2709 pctgdp_export_2710 pctgdp_export_2711 pctgdp_export_28 pctgdp_export_29 pctgdp_export_30 pctgdp_export_31 pctgdp_export_32 pctgdp_export_33 pctgdp_export_34 pctgdp_export_35 pctgdp_export_36 pctgdp_export_37 pctgdp_export_38 pctgdp_export_39 pctgdp_export_40 pctgdp_export_41 pctgdp_export_42 pctgdp_export_43 pctgdp_export_44 pctgdp_export_45 pctgdp_export_46 pctgdp_export_47 pctgdp_export_48 pctgdp_export_49 pctgdp_export_50 pctgdp_export_51 pctgdp_export_52 pctgdp_export_53 pctgdp_export_54 pctgdp_export_55 pctgdp_export_56 pctgdp_export_57 pctgdp_export_58 pctgdp_export_59 pctgdp_export_60 pctgdp_export_61 pctgdp_export_62 pctgdp_export_63 pctgdp_export_64 pctgdp_export_65 pctgdp_export_66 pctgdp_export_67 pctgdp_export_68 pctgdp_export_69 pctgdp_export_70 pctgdp_export_71 pctgdp_export_72 pctgdp_export_73 pctgdp_export_74 pctgdp_export_75 pctgdp_export_76 pctgdp_export_78 pctgdp_export_79 pctgdp_export_80 pctgdp_export_81 pctgdp_export_82 pctgdp_export_83 pctgdp_export_84 pctgdp_export_85 pctgdp_export_86 pctgdp_export_87 pctgdp_export_88 pctgdp_export_89 pctgdp_export_90 pctgdp_export_91 pctgdp_export_92 pctgdp_export_93 pctgdp_export_94 pctgdp_export_95 pctgdp_export_96 pctgdp_export_97 pctgdp_export_99
global pct_imports  pctgdp_import_01 pctgdp_import_02 pctgdp_import_03 pctgdp_import_04 pctgdp_import_05 pctgdp_import_06 pctgdp_import_07 pctgdp_import_08 pctgdp_import_09 pctgdp_import_10 pctgdp_import_11 pctgdp_import_12 pctgdp_import_13 pctgdp_import_14 pctgdp_import_15 pctgdp_import_16 pctgdp_import_17 pctgdp_import_18 pctgdp_import_19 pctgdp_import_20 pctgdp_import_21 pctgdp_import_22 pctgdp_import_23 pctgdp_import_24 pctgdp_import_25 pctgdp_import_26 pctgdp_import_27 pctgdp_import_2709 pctgdp_import_2710 pctgdp_import_2711 pctgdp_import_28 pctgdp_import_29 pctgdp_import_30 pctgdp_import_31 pctgdp_import_32 pctgdp_import_33 pctgdp_import_34 pctgdp_import_35 pctgdp_import_36 pctgdp_import_37 pctgdp_import_38 pctgdp_import_39 pctgdp_import_40 pctgdp_import_41 pctgdp_import_42 pctgdp_import_43 pctgdp_import_44 pctgdp_import_45 pctgdp_import_46 pctgdp_import_47 pctgdp_import_48 pctgdp_import_49 pctgdp_import_50 pctgdp_import_51 pctgdp_import_52 pctgdp_import_53 pctgdp_import_54 pctgdp_import_55 pctgdp_import_56 pctgdp_import_57 pctgdp_import_58 pctgdp_import_59 pctgdp_import_60 pctgdp_import_61 pctgdp_import_62 pctgdp_import_63 pctgdp_import_64 pctgdp_import_65 pctgdp_import_66 pctgdp_import_67 pctgdp_import_68 pctgdp_import_69 pctgdp_import_70 pctgdp_import_71 pctgdp_import_72 pctgdp_import_73 pctgdp_import_74 pctgdp_import_75 pctgdp_import_76 pctgdp_import_78 pctgdp_import_79 pctgdp_import_80 pctgdp_import_81 pctgdp_import_82 pctgdp_import_83 pctgdp_import_84 pctgdp_import_85 pctgdp_import_86 pctgdp_import_87 pctgdp_import_88 pctgdp_import_89 pctgdp_import_90 pctgdp_import_91 pctgdp_import_92 pctgdp_import_93 pctgdp_import_94 pctgdp_import_95 pctgdp_import_96 pctgdp_import_97 pctgdp_import_99

*subset to just the pctgdps that correspond to $included_vars
*modify the local new_ equation to change to exports or imports
global comm_codes
global comm_keep
foreach var_ in $included_vars{
	local new_="pctgdp_export_"+substr("`var_'",17,18)
	local code_=substr("`var_'",17,18)
	display `code_'
	global new `new_'
	global code `code_'
	global comm_keep: list global(comm_keep) | global(new)
	global comm_codes: list global(comm_codes) | global(code)
}

keep v1 year reporteriso reportercode wba3 gdp_2005usd $comm_keep


preserve
clear
*get the average betas (using copy of code from above)
svmat beta_means, names(col)
xpose, varname clear
sort v1
*drop inversely correlated commodities
drop if v1>=0

*gen column with just comm code
*need to include years of 
gen comm_c=substr(_varname,22,22)
destring comm_c, replace
gen timespan=substr(_varname,12,12)

*some show up twice because they have both 3 and 5 year significance
*take the one with greater effect. 
gsort - v1
duplicates drop comm_c, force


*assign to risk classes of 1,2,3 which correspond to low, med, high
*a better way to do this would be by standard dev
sort v1
gen ptile=_n/_N
gen risk_class=.

replace risk_class=1 if ptile<=.33
replace risk_class=2 if ptile>.33 & ptile<=.66
replace risk_class=3 if ptile>.66

*put into matrix, first sort by code so matches
sort comm_c
mkmat risk_class, matrix(risk_classes) rownames(comm_c)
putexcel A1=matrix(risk_classes, names) using maier_thesis_risk_classes_pos, replace

*assign comm codes to global risk level globals
global risk_low
global risk_med
global risk_hi

*loop through codes of risky comms and assign to risk global
foreach comm_ in $comm_codes{
	quietly sum risk_class if comm_c==`comm_'
	local clas=r(mean)
	local new="pctgdp_export_`comm_'"
	global new_ `new'
	if `clas'==1{
		global risk_low: list global(risk_low) | global(new_)
	}
	if `clas'==2{
		global risk_med: list global(risk_med) | global(new_)
	}
	if `clas'==3{
		global risk_hi: list global(risk_hi) | global(new_)
	}
}
restore

************
*these are actually all high risk, "lowrisk" variables are the lowest of the high risk vars
*calculate total pct gdp of risky commodities (low, med, hi risk all included)
egen pct_gdp_lowrisk=rowtotal($risk_low)
egen pct_gdp_medrisk=rowtotal($risk_med)
egen pct_gdp_highrisk=rowtotal($risk_hi)

gen total_pct_risky= pct_gdp_lowrisk +pct_gdp_medrisk+ pct_gdp_highrisk
gen total_pct_notrisky=1-total_pct_risky

global propos pct_gdp_lowrisk pct_gdp_medrisk pct_gdp_highrisk 
foreach propo in $propos {
	replace `propo'=. if  gdp_2005usd==.
}

*add country names
sort wba3
merge wba3 using wba_names
drop if _merge==2
drop _merge
drop pctgdp*
 
*plot means over time
preserve
gen holder=1
egen mean_pct_low = mean(pct_gdp_lowrisk), by(year) 
egen mean_pct_med = mean(pct_gdp_medrisk), by(year) 
egen mean_pct_high = mean(pct_gdp_highrisk), by(year) 

keep year holder mean_pct_low mean_pct_med mean_pct_high
duplicates drop  mean_pct_low mean_pct_med mean_pct_high, force
gen high=mean_pct_high+ mean_pct_med+mean_pct_low
gen med=mean_pct_med+mean_pct_low
gen low=mean_pct_low

*gen stacked area graphs for PERCENT
xtset holder year, y
twoway (area high year, color(red)) ///
	(area  med  year, color(orange)) ///
	(area low year, color(yellow)), ytitle(Mean Percent GDP) ///
	legend(order(1 "Highest risk exports" 2 "Higher risk exports" 3 "High risk exports"))
graph save risk_mean_growth, replace
restore

*export per-coutnry-year to excel and .dta
order v1 year  reporteriso reportercode wba3 wbcountry ISOA3  gdp_2005usd total_pct_notrisky total_pct_risky
save maier_thesis_risk_classes, replace

export delimited using "maier_thesis_risk_for_timeseries.csv", replace

preserve
keep if year==2014
export delimited using "maier_thesis_risk_for_picharts.csv", replace
restore








******************
*stepwise simulations
gen random=.
gen training=.

program sampl
	drop random training

	*sample 70% of data
	gen random = runiform()
	gen training=0
	replace training=1 if random<=0.7
	sort training
	
	*stepwise regression. make sure this runs with 'simulate'. pr signifies backwards selection
	*pr() specifies the CI
	stepwise, pr(.1) lockterm1: reg polstab (gdppc2005 elf1 pol1 lpop  polity zstat_03_export_27) $regressors if training==1
end
	
simulate _b, reps(5000): sampl
summarize _all
save "maier_thesis_betas_06April2016.dta", replace


*******************
*estimate the residuals, i.e. differences between predicted and real in the test set
clear all
use "maier_thesis_UNCOMTRADE_allzstats_working.dta", clear
gen random=.
gen training=.
gen hat_polstab=.
gen diff=.

program define diffs, rclass
	drop random training hat_polstab diff
	
	*sample 70% of data
	gen random = runiform()
	gen training=0
	replace training=1 if random<=0.7
	sort training
	
	*stepwise regression. make sure this runs with 'simulate'. pr signifies backwards selection
	*pr() specifies the CI
	stepwise, pr(.1) lockterm1: reg polstab (gdppc2005 elf1 pol1 lpop  polity zstat_03_export_27) $regressors if training==1
	predict hat_polstab
	
	*measure predictive error on test set
	gen diff=hat_polstab-polstab if training==0
	
	*return average differences
	summarize diff
	return scalar mean = r(mean)
	return scalar var=r(Var)
	return scalar sd = r(sd)
	return scalar sum = r(sum)
	return scalar N=r(N)
end
	
*use "maier_thesis_UNCOMTRADE_allzstats_working.dta", clear
simulate diffs_mean=r(mean) diffs_var=r(Var) diffs_sd=r(sd) diffs_sum=r(sum) diffs_n=r(N), reps(5000): diffs
summarize _all
kdensity diffs_mean

save "maier_thesis_performance_06April2016.dta", replace


*******************************
*calculate various statistics about the betas
clear all
use "maier_thesis_betas.dta", clear
summarize _all

graph hbox _all, noout boxgap(30)
dotplot,  center yaxis(vertical) yline(-.3 -.2 -.1 .1 .2 .3, lpattern(dot)) yline(0, lpattern(dash)) msize(vsmall)

*this saves the ebtas as table in excel
estpost summarize
esttab using "maier_simulations_results_exports_06April2016.xls",replace cells("count mean sd min max") label title(Table 1:Summary statistics) mtitles("Panel A:Firm Characteristics")



*******************************
*use beta estimates to predict otucome
clear all
use "maier_thesis_UNCOMTRADE_allzstats_working.dta", clear
xtset reportercode year, y

*predict based on coefficients
gen polstab_hat_comms = ///
	gdppc2005*0.0000271 + ///
	elf1*1.89484 + ///
	pol1*-1.45119 + ///
	lpop*-0.21511 + ///
	polity*0.008987 + ///
	zstat_03_export_27*0.0224 + ///
	zstat_03_export_24*0.07016 + ///
	zstat_03_export_73*-0.11193 + ///
	zstat_03_export_08*-0.14518 + ///
	zstat_05_export_83*0.090106 + ///
	zstat_03_export_17*-0.09015 + ///
	zstat_05_export_29*-0.11191 + ///
	zstat_03_export_30*0.087391 + ///
	zstat_05_export_38*0.111866 + 3.361363
*commodity 30 sucks

*predict with just control variables, for comparison
reg polstab gdppc2005 elf1 pol1 lpop  polity
predict polstab_hat_controls
avplots
graph save avplots_, replace

twoway (kdensity polstab) (kdensity polstab_hat_comms), title("Distributions of Model-Predicted and Actual Political Stability")
graph save kdensity_predicted_comms, replace
twoway (kdensity polstab) (kdensity polstab_hat_controls), title("Distributions of Control-Predicted and Actual Political Stability")
graph save kdensity_predicted_controls, replace


*gen errors for model with commoditiy variables and with just controls
*errors
gen errors_comms=polstab_hat_comms-polstab
gen errors_controls=polstab_hat_controls-polstab

*squared residuals (for SSR)
gen sq_errors_comms=errors_comms^2
gen sq_errors_controls=errors_controls^2

summarize sq_errors_comms
scalar ssr_comms=r(sum)
summarize sq_errors_controls
scalar ssr_controls=r(sum)


*squared explained (for SSE) predicted minus average
summarize polstab
scalar polstab_mean = r(mean)

gen explained_comms=(polstab_hat_comms-scalar(polstab_mean))^2
gen explained_controls=(polstab_hat_controls-scalar(polstab_mean))^2

summarize explained_comms
scalar sse_comms=r(sum)
summarize explained_controls
scalar sse_controls=r(sum)


*squares (for SST)
gen sq_var_polstab=(polstab-scalar(polstab_mean))^2
summarize sq_var_polstab
scalar sst_polstab=r(sum)

*display R-sq calculated by hand
display(sse_comms/sst_polstab)
display(sse_controls/sst_polstab)



*out graphs
scatter errors_comms errors_controls
graph save error_correlations_commsVsControl, replace

*check how the errors are distributed
scatter errors_comms polstab, yscale(range(-2 3)) msize(vsmall) title("Political Stability Scores versus Prediction Errors (full model)") xtitle("Political Stability Score") ytitle("Error") legend(off)
graph save errors_comms_vs_polstab, replace
scatter errors_controls polstab, yscale(range(-2 3)) msize(vsmall) title("Political Stability Scores versus Prediction Errors (control model)") xtitle("Political Stability Score") ytitle("Error") legend(off)
graph save errors_controls_vs_polstab, replace

lpoly errors_comms polstab, ci level(95) yscale(range(-2 3)) msize(vsmall) title("Political Stability Scores versus Prediction Errors") xtitle("Political Stability Score") ytitle("Error") legend(off)
lpoly errors_controls polstab, ci level(95) yscale(range(-2 3)) msize(vsmall) title("Political Stability Scores versus Prediction Errors (controls)") xtitle("Political Stability Score") ytitle("Error") legend(off)















